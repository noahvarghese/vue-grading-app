<!DOCTYPE html>
<html>
    <head>
        <!-- Standard website things -->
        <title>Grading App</title> 
        <meta charset="utf-8"/>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width,initial-scale=1.0">
        <link href="/favicon.ico" rel="icon" type="image/x-icon">

        <!-- Vue -->
        <script src="https://unpkg.com/vue/dist/vue.js"></script>
        <!-- <script src="https://cdn.jsdelivr.net/npm/vue"></script> -->

        <!-- Custom Vue Components -->
        <!-- <script src="/components/grades.vue.js"></script> -->

        <!---------------->
        <!--   Fonts    -->
        <!---------------->

        <!-- Noto Sans -->
        <link rel="preconnect" href="https://fonts.gstatic.com">
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP" rel="stylesheet">
        
        <!-- Roboto -->
        <link href="https://fonts.googleapis.com/css2?family=Roboto" rel="stylesheet">

        <!-- Custom styles -->
        <link href="/assets/css/styles.css" rel="stylesheet">

        <!-- Toggle button -->
        <script src="https://cdn.jsdelivr.net/npm/vue-js-toggle-button@1.3.3/dist/index.min.js"></script>
    </head>
    <body>
        <div id="root">
            <div id="grades">
                <nav>
                    <h1>Vue My Courses</h1>
                </nav>
                <h1 class="title">Grades</h1>
                <div id="container">
                    <div id="toolBar">
                        <div>
                            <transition name="flip" mode="out-in">
                                <div v-if="show">
                                    <input v-model="searchText" type="search" name="search" placeholder="Search" id="search" />
                                    <button :class="[showHonours ? 'active' : '']" v-on:click="setHonours">Honours</button>
                                    <button :class="[showFailed ? 'active' : '']" v-on:click="setFailed">Failed</button>
                                </div>
                            </transition>
                        </div>
                        <button v-on:click="show = !show"><span v-if="show">Create</span><span v-else>Cancel</span></button>
                    </div>
                    <transition name="flip" mode="out-in">
                        <table id="allGrades" v-if="show">
                            <thead id="columnHeadings">
                                <tr>
                                    <th class="course">
                                        Course
                                        <div class="sort">
                                            <img v-on:click="sortCourseAsc" class="sortImg" src="/assets/img/asc.png" alt="ascending" />
                                            <img v-on:click="sortCourseDesc" class="sortImg" src="/assets/img/desc.png" alt="descending" />
                                        </div>
                                    </th>
                                    <th class="grade">
                                        Grade
                                        <div class="sort">
                                            <img v-on:click="sortGradeAsc" class="sortImg" src="/assets/img/asc.png" alt="ascending" />
                                            <img v-on:click="sortGradeDesc" class="sortImg" src="/assets/img/desc.png" alt="descending" />
                                        </div>
                                    </th>
                                    <th></th>
                                </tr>
                            </thead>
                            <!-- <transition-group name="bounce" tag="tr"> -->
                            <tbody name="bounce" is="transition-group">
                                <tr v-for="grade in grades" v-bind:key="grade.course">
                                    <td>{{ grade.course }}</td>
                                    <td>{{ grade.grade }}</td>
                                    <td>
                                        <div class="imgContainer">
                                            <img v-on:click="edit(grade)" src="/assets/img/edit.png" alt="edit" course="grade.course"/>
                                            <img v-on:click="remove(grade)" src="/assets/img/delete.png" alt="delete" />
                                        </div>
                                    </td>
                                </tr>
                            <!-- </transition-group> -->
                            </tbody>
                        </table>
                        <div id="createGrade" v-else>
                            <div>
                                <h2>Create New</h2>
                            </div>    
                            <form>
                                <div class="input">
                                    <input v-model="course" type="text" name="course" id="course" autocomplete="off" required />
                                    <label for="course">
                                        <span>Course</span>
                                    </label>
                                </div>
                                <div class="input">
                                    <input v-model="grade" type="number" name="grade" id="grade" aria-label="grade" autocomplete="off" required />
                                    <label for="grade">
                                        <span>Grade</span>
                                    </label>
                                </div>
                                <button v-on:click="create">Create</button>
                            </form>
                        </div>
                    </transition>
                </div>
            </div>
        </div>
        <script>
            let grades = [{ course: "test", grade: 0}];
            let filteredGrades = [];
            // Deep copy of grades so any modifications to filtered 
            // array don't affect the other
            grades.forEach(grade => filteredGrades.push(grade));
            let grade = "";
            let course = "";
            let searchText = "";

            window.addEventListener("load", () => {
                // Vue.component("Grades", Grades);
                // const root = new Vue({}).$mount("#root");
                new Vue({
                    el: "#root",
                    data: function() {
                        return {
                            show: true,
                            grades: filteredGrades,
                            course,
                            grade,
                            searchText,
                            showHonours: true,
                            showFailed: true
                        }
                    },
                    watch: {
                        searchText: function(newValue, oldValue) {
                            let _searchText = newValue;
                            if ( _searchText !== "" ) {
                                this.grades = grades.filter((grade) => {
                                    if ( grade.course.includes(_searchText) ) {
                                        return true;
                                    }
                                    else if ( grade.grade.toString().includes(_searchText) ) {
                                        return true;
                                    }

                                    return false;
                                })
                            }
                            else {
                                this.grades = grades;
                            }
                        }
                    },
                    methods: {
                        create: function(event) {
                            event.preventDefault();
                            // check if the course is added already
                            // or grade < 0 or > 100
                            // send back an error
                            this.grades.push({course: this.course, grade: this.grade});
                            this.show = !this.show;
                            this.course = "";
                            this.grade = "";
                        },
                        edit: function(courseGrade) {
                            this.course = courseGrade.course;
                            this.grade = courseGrade.grade;
                            this.show = !this.show;
                            // need to make a way that saving updates this
                        },
                        remove: function(courseGrade) {
                            const index = this.grades.indexOf(courseGrade);
                            this.grades.splice(index, 1);
                        },
                        sortCourseAsc: function(event) {

                        },
                        sortCourseDesc: function(event) {

                        },
                        sortGradeAsc: function(event) {

                        },
                        sortGradeDesc: function(event) {

                        },
                        setHonours: function() {
                            this.showHonours = !this.showHonours;

                            if ( ! this.showHonours ) {
                                // show everything below 80
                                this.grades = grades.filter((grade) => grade.grade < 80);
                            } else {
                                //
                            }
                        },
                        setFailed: function() {
                            this.showFailed = !this.showFailed;
                            if ( ! this.showFailed ) {
                                this.grades = grades.filter((grade) => grade.grade > 49);
                            } else {

                            }
                        },
                        
                    }
                })
            });
        </script>
    </body>
</html>
